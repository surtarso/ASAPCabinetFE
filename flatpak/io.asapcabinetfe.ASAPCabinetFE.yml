id: io.asapcabinetfe.ASAPCabinetFE
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk

sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
  - org.freedesktop.Sdk.Extension.ffmpeg

command: ASAPCabinetFE

finish-args:
  - --share=network
  - --share=ipc
  - --device=dri
  - --filesystem=host
  - --socket=pulseaudio
  - --socket=wayland
  - --socket=x11
  - --talk-name=org.freedesktop.Flatpak
  - --system-talk-name=org.freedesktop.login1
  - --env=SDL_JOYSTICK_WGI=1

cleanup:
  - /include
  - '*.la'
  - '*.a'

modules:
  - name: asapcabinetfe
    buildsystem: cmake
    builddir: true

    build-options:
      wipe: true
      env:
        - FLATPAK_BUILD=1
        - PATH=/usr/lib/sdk/rust-stable/bin:/usr/lib/sdk/x86_64/usr/bin:/usr/lib/sdk/bin:/usr/bin

    config-opts:
      - -DFLATPAK_IS_BUILDING_CMAKE=ON
      - -DCMAKE_BUILD_TYPE=Release

    sources:
      - type: dir
        path: ../../ASAPCabinetFE

      # - type: git
      #   url: https://github.com/surtarso/ASAPCabinetFE.git
      #   tag: v1.2.15

      # cmake FetchContent sources mirror
      - type: file  # pugixml
        url: https://github.com/zeux/pugixml/releases/download/v1.15/pugixml-1.15.tar.gz
        sha256: 655ade57fa703fb421c2eb9a0113b5064bddb145d415dd1f88c79353d90d511a

      - type: file  # rapidfuzz-cpp
        url: https://github.com/rapidfuzz/rapidfuzz-cpp/archive/refs/tags/v3.3.3.tar.gz
        sha256: fa0fbd40110df8134cf05bddbaa4e237dbc4fd915ab9a3029ff481a8d3e8b757

      - type: file  # ImGui
        url: https://github.com/ocornut/imgui/archive/refs/tags/v1.92.4.tar.gz
        sha256: 0e175d4d941112532549b418ced0bd546abe9024ecb9b5f431f8a67a2197b0ba

      - type: file  # ImGuiFileDialog
        url: https://github.com/aiekick/ImGuiFileDialog/archive/refs/tags/v0.6.8.tar.gz
        sha256: 7aa3fbb0fc7206c5b434246d906f036057a59eb51e28ae36488aa654a667a266

      - type: file  # vpin crate
        url: https://github.com/francisdb/vpin/archive/refs/tags/v0.18.6.tar.gz
        sha256: 0d79288f6ac3adc8a5dc4bf8ae60cf06ccad1d1beede9e8c51f0fb8e3581a3b6

    post-install:
      - install -Dm644 flatpak/io.asapcabinetfe.ASAPCabinetFE.svg /app/share/icons/hicolor/scalable/apps/io.asapcabinetfe.ASAPCabinetFE.svg

      - desktop-file-install --dir=/app/share/applications/ flatpak/io.asapcabinetfe.ASAPCabinetFE.desktop

      - install -Dm644 flatpak/io.asapcabinetfe.ASAPCabinetFE.metainfo.xml /app/share/metainfo/io.asapcabinetfe.ASAPCabinetFE.metainfo.xml
